<div *ngIf="isLoading" style="text-align: center">
  <app-loading-spinner></app-loading-spinner>
</div>

<div
  style="margin-left: 10px; margin-top: 10px"
  *ngIf="!startReviewSearch && reviews.length < 1 && !isLoading"
>
  <h3 class="mat-h3 mat-subheading-2">Nenhuma resenha foi adicionada</h3>
</div>

<ng-template [ngIf]="startReviewSearch">
  <div style="margin-left: 10px; margin-top: 10px" *ngIf="!isReviewFound">
    <h3 class="mat-h3 mat-subheading-2">
      Resenha nao encontrada para o livro
      <span style="font-size: x-large">"{{ bookTitleSearch }}"</span>
    </h3>
  </div>

  <div style="margin-left: 10px; margin-top: 10px" *ngIf="isReviewFound">
    <h3 class="mat-h3 mat-subheading-2">
      Resultado da busca para o termo<span style="font-size: x-large"
        >"{{ bookTitleSearch }}"</span
      >
    </h3>
  </div>
</ng-template>

<cdk-virtual-scroll-viewport
  itemSize="100"
  style="height: 90vh"
  minBufferPx="2000"
  maxBufferPx="2000"
>
  <div
    fxLayoutAlign.lt-sm="space-around center"
    fxLayoutAlign.lt-md="space-strecht start"
    fxLayoutAlign.lt-lg="space-strecht start"
    fxLayoutAlign.lt-xl="space-strecht start"
    fxLayoutAlign.gt-lg="space-strecht start"
    fxLayout.lt-sm="column"
    fxLayout.lt-md="row wrap"
    fxLayout.lt-lg="row wrap"
    fxLayout.lt-xl="row wrap"
    fxLayout.gt-lg="row wrap"
    class="review-box"
  >
    <div
      fxFlex.lt-md="50"
      fxFlex.lt-lg="50"
      fxFlex.lt-xl="25"
      fxFlex.gt-lg="20"
      class="review"
      *cdkVirtualFor="let review of reviews; let i = index"
    >
      <div *ngIf="review">
        <mat-card class="review-card">
          <div id="card-header" style="height: 75%">
            <h3 class="book-title mat-h3 mat-subheading-2">
              {{ review.bookTitle }}
            </h3>

            <p class="review-info mat-body mat-body-1">{{ review.review }}</p>
          </div>

          <div
            id="card-info"
            style="display: flex; height: 15%; margin-top: 1rem"
          >
            <mat-card-actions>
              <button
                mat-button="mat-button"
                (click)="addReviewToFavorites(i)"
                title="Curtir"
                [disabled]="!isAuthenticated"
                *ngIf="!canEditReview"
              >
                <mat-icon color="{{ review.likes > 0 ? 'warn' : 'basic' }}"
                  >favorite</mat-icon
                >
                <span *ngIf="review.likes > 0">{{ review.likes }}</span>
              </button>
              <button
                mat-button="mat-button"
                (click)="seeReview(i)"
                title="Ver resenha"
              >
                <mat-icon>preview</mat-icon>
              </button>
              <button
                mat-button="mat-button"
                (click)="editReview(i)"
                *ngIf="canEditReview"
                title="Editar"
              >
                <mat-icon>mode_edit</mat-icon>
              </button>
              <button
                mat-button="mat-button"
                (click)="deleteReview(i)"
                *ngIf="canEditReview"
                title="Excluir"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </mat-card-actions>
          </div>

          <div id="card-bottom" style="display: flex; height: 10%">
            <div id="date" style="width: 60%">
              <span class="mat-small mat-caption">
                {{ review.id | objectidToDate | date: "dd/MM/yyyy HH:mm" }}
              </span>
            </div>

            <div style="width: 40%; text-align: right">
              <span
                id="nickname"
                style="outline: none"
                class="mat-small mat-caption"
                [routerLink]="['/users/profile']"
                [queryParams]="{ userId: review.userId }"
                >{{ review.nickname }}</span
              >
            </div>
          </div>
        </mat-card>
      </div>
      <div *ngIf="!review">Carregando ...</div>
    </div>
  </div>
</cdk-virtual-scroll-viewport>
